class Compiler {
    static function compileFiles(options: Options) throws CompilerError {
        let files: [String] = options.files
        mutable sources: [String] = [String]();
        for file: String in files {
            let source: String = File.readToString(file)
                catch noSuchFileOrDirectory(error: FileError) throw fileNotFound(file)
                catch _ (error: FileError) throw unableToReadFile(file, error)
                
            sources.push(source)
        }

        mutable compilationUnits: [CompilationUnit] = [CompilationUnit]();
        let index: unsigned = 0
        for source: String in sources {
            let compilationUnit: CompilationUnit = compileUnit(files[index], source)
                catch _ (error: CompilerError) throw syntaxError(error)

            compilationUnits.push(compilationUnit);
            index++
        }

        mutable program: Program = Program(options.outputName, options.directory, [CompilationUnit](compilationUnits))
        for item: CompilationUnit in compilationUnits
            item.parent = program
        
        mutable visitor: CppVisitor = CppVisitor()
        
        visitor.execute(program)
            catch CppError.unableToCreateOutputDirectory(uTCOD: unableToCreateOutputDirectory) throw unableToCreateOutputDirectory(uTCOD.directory, uTCOD.error)
    }

    static function compileUnit(fileName: String, text: String) -> CompilationUnit throws ParserError {
        mutable parser: Parser = Parser(fileName, text)
        let compilationUnit: CompilationUnit = parser.parseCompilationUnit()
            catch _ (error: ParserError)
                throw error
        return compilationUnit
    }
};
